<html>

<head>
  <title>piano-a-playa</title>
  <style>
    rect:hover {
      fill: gray;
    }

    rect:active {
      fill: blue;
    }
  </style>
  <script>
    function note(noteName) {
      sound = new Audio(`Piano.mf.${noteName}.mp3`)
      sound.play()
    }

    keyToNoteMap = {
      'a': 'C4',
      'w': 'Db4',
      's': 'D4',
      'e': 'Eb4',
      'd': 'E4',
      'f': 'F4',
      't': 'Gb4',
      'g': 'G4',
      'y': 'Ab4',
      'h': 'A4',
      'u': 'Bb4',
      'j': 'B4'
    };

    document.onkeydown = function(event) {
      event = event || window.event;
      if (event.key in keyToNoteMap) {
        note(keyToNoteMap[event.key])
        // console.log(keyToNoteMap[event.key])
      }
    }

    // function pageLog(x) {
    //   document.getElementById('pageLog').innerHTML = x + "<br />" + document.getElementById('pageLog').innerHTML
    // }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    noteMsLength = 250

    async function playSong() {
      // console.log('Taking a break...');
      // await sleep(2000);
      // console.log('Two seconds later, showing sleep in a loop...');
      url = new URL(window.location)
      notes = url.searchParams.get('notes')
      spaceSplit = notes.split(" ")
      console.log(`spaceSplit = ${spaceSplit}`)
      console.log(`spaceSplit.length = ${spaceSplit.length}`)

      // window.prompt("ready to play the song?")
      await sleep(noteMsLength)

      while (spaceSplit.length > 0) {
        noteAndLength = spaceSplit.shift()
        console.log(`noteAndLength = ${noteAndLength}`)

        durationMult = noteAndLength.length
        console.log(`durationMult = ${durationMult}`)

        noteVal = noteAndLength[0].toUpperCase() + '4'
        console.log(`noteVal = ${noteVal}`)

        note(noteVal)

        await sleep(noteMsLength * durationMult)
      }
    }
  </script>
</head>

<body>
  <svg width="483" height="360">
    <rect onmousedown="note('C4')" fill="white" stroke="black" x="0" y="0" width="69" height="360" />
    <rect onmousedown="note('D4')" fill="white" stroke="black" x="69" y="0" width="69" height="360" />
    <rect onmousedown="note('E4')" fill="white" stroke="black" x="138" y="0" width="69" height="360" />
    <rect onmousedown="note('F4')" fill="white" stroke="black" x="207" y="0" width="69" height="360" />
    <rect onmousedown="note('G4')" fill="white" stroke="black" x="276" y="0" width="69" height="360" />
    <rect onmousedown="note('A4')" fill="white" stroke="black" x="345" y="0" width="69" height="360" />
    <rect onmousedown="note('B4')" fill="white" stroke="black" x="414" y="0" width="69" height="360" />

    <rect onmousedown="note('Db4')" fill="black" stroke="black" x="43" y="0" width="39" height="240" />
    <rect onmousedown="note('Eb4')" fill="black" stroke="black" x="125" y="0" width="39" height="240" />
    <rect onmousedown="note('Gb4')" fill="black" stroke="black" x="246.75" y="0" width="39" height="240" />
    <rect onmousedown="note('Ab4')" fill="black" stroke="black" x="324.75" y="0" width="39" height="240" />
    <rect onmousedown="note('Bb4')" fill="black" stroke="black" x="404.25" y="0" width="39" height="240" />
  </svg>

  <button onclick="playSong()">play song</button>

  <!-- <div id="pageLog"></div> -->
</body>

</html>
